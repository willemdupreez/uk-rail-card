{"version":3,"file":"uk-rail-card.js","sources":["../src/uk-rail-card.ts"],"sourcesContent":["interface RailCardConfig {\n  type: string;\n  title?: string;\n  device: string;\n}\n\ntype HomeAssistant = {\n  states: Record<\n    string,\n    { state: string; attributes: Record<string, unknown> }\n  >;\n};\n\nconst version = '__VERSION__';\n\nconsole.info(\n  \"%c UK-RAIL-CARD %c \".concat(version, \" \"),\n  \"color: white; background: navy; font-weight: 700;\",\n  \"color: navy; background: white; font-weight: 700;\"\n);\n\nclass UkRailCard extends HTMLElement {\n  private _config?: RailCardConfig;\n  private _hass?: HomeAssistant;\n\n  constructor() {\n    super();\n    this.attachShadow({ mode: \"open\" });\n  }\n\n  static getStubConfig(): RailCardConfig {\n    return {\n      type: \"custom:uk-rail-card\",\n      title: \"Rail Services\",\n      device: \"rail_station\",\n    };\n  }\n\n  static getConfigElement(): HTMLElement {\n    return document.createElement(\"uk-rail-card-editor\");\n  }\n\n  setConfig(config: RailCardConfig): void {\n    if (!config.device) {\n      throw new Error(\"You must define a device\");\n    }\n\n    this._config = config;\n    this.render();\n  }\n\n  set hass(hass: HomeAssistant) {\n    this._hass = hass;\n    this.render();\n  }\n\n  getCardSize(): number {\n    return 3;\n  }\n\n  private findEntityId(suffix: string): string | undefined {\n    if (!this._hass) {\n      return undefined;\n    }\n\n    return Object.keys(this._hass.states).find((entityId) =>\n      entityId.endsWith(suffix)\n    );\n  }\n\n  private getEntityState(entityId?: string): string {\n    if (!entityId || !this._hass) {\n      return \"\";\n    }\n\n    return this._hass.states[entityId]?.state ?? \"\";\n  }\n\n  private render(): void {\n    if (!this.shadowRoot || !this._config || !this._hass) {\n      return;\n    }\n\n    const deviceSuffix = this._config.device;\n    const maxEntityId =\n      this.findEntityId(`${deviceSuffix}_max_services`) ||\n      this.findEntityId(\"max_services\");\n    const maxServices = Number(this.getEntityState(maxEntityId)) || 0;\n\n    const rows: Array<{\n      scheduled: string;\n      destination: string;\n      estimated: string;\n    }> = [];\n\n    for (let index = 1; index <= maxServices; index += 1) {\n      const destinationId =\n        this.findEntityId(`${deviceSuffix}_${index}_destination`) ||\n        this.findEntityId(`${index}_destination`);\n      const destination = this.getEntityState(destinationId).trim();\n\n      if (!destination) {\n        break;\n      }\n\n      const scheduledId =\n        this.findEntityId(`${deviceSuffix}_${index}_scheduled_time`) ||\n        this.findEntityId(`${index}_scheduled_time`);\n      const estimatedId =\n        this.findEntityId(`${deviceSuffix}_${index}_estimated_time`) ||\n        this.findEntityId(`${index}_estimated_time`);\n\n      rows.push({\n        scheduled: this.getEntityState(scheduledId) || \"-\",\n        destination,\n        estimated: this.getEntityState(estimatedId) || \"-\",\n      });\n    }\n\n    const title = this._config.title?.trim();\n\n    this.shadowRoot.innerHTML = `\n      <style>\n        :host {\n          display: block;\n        }\n\n        ha-card {\n          overflow: hidden;\n        }\n\n        .header {\n          padding: 16px 16px 0 16px;\n        }\n\n        .title {\n          font-size: 1.1rem;\n          font-weight: 600;\n          line-height: 1.4;\n        }\n\n        .table {\n          display: grid;\n          grid-template-columns: minmax(70px, 0.8fr) 2fr minmax(70px, 0.8fr);\n          gap: 4px 12px;\n          padding: 16px;\n        }\n\n        .head {\n          font-size: 0.75rem;\n          letter-spacing: 0.06em;\n          text-transform: uppercase;\n          color: var(--secondary-text-color);\n        }\n\n        .row {\n          display: contents;\n          font-size: 0.95rem;\n        }\n\n        .cell {\n          padding: 4px 0;\n          border-bottom: 1px solid rgba(0, 0, 0, 0.08);\n        }\n\n        .row:last-of-type .cell {\n          border-bottom: none;\n        }\n\n        .empty {\n          padding: 16px;\n          color: var(--secondary-text-color);\n          font-style: italic;\n        }\n      </style>\n      <ha-card>\n        ${\n          title\n            ? `<div class=\"header\"><div class=\"title\">${title}</div></div>`\n            : \"\"\n        }\n        ${\n          rows.length\n            ? `\n              <div class=\"table\">\n                <div class=\"head\">Scheduled</div>\n                <div class=\"head\">Destination</div>\n                <div class=\"head\">Estimated</div>\n                ${rows\n                  .map(\n                    (row) => `\n                      <div class=\"row\">\n                        <div class=\"cell\">${row.scheduled}</div>\n                        <div class=\"cell\">${row.destination}</div>\n                        <div class=\"cell\">${row.estimated}</div>\n                      </div>\n                    `\n                  )\n                  .join(\"\")}\n              </div>\n            `\n            : `<div class=\"empty\">No services available.</div>`\n        }\n      </ha-card>\n    `;\n  }\n}\n\nclass UkRailCardEditor extends HTMLElement {\n  private _config?: RailCardConfig;\n  private _hass?: HomeAssistant;\n\n  constructor() {\n    super();\n    this.attachShadow({ mode: \"open\" });\n  }\n\n  setConfig(config: RailCardConfig): void {\n    this._config = { ...config };\n    this.render();\n  }\n\n  set hass(hass: HomeAssistant) {\n    this._hass = hass;\n    this.render();\n  }\n\n  private updateConfigValue(key: keyof RailCardConfig, value: string): void {\n    if (!this._config) {\n      return;\n    }\n\n    const nextConfig: RailCardConfig = { ...this._config };\n    const trimmed = value.trim();\n\n    if (key === \"title\") {\n      if (trimmed) {\n        nextConfig.title = trimmed;\n      } else {\n        delete nextConfig.title;\n      }\n    } else if (key === \"device\") {\n      nextConfig.device = trimmed;\n    } else {\n      nextConfig[key] = value;\n    }\n\n    this._config = nextConfig;\n    this.dispatchEvent(\n      new CustomEvent(\"config-changed\", {\n        detail: { config: nextConfig },\n        bubbles: true,\n        composed: true,\n      })\n    );\n  }\n\n  private render(): void {\n    if (!this.shadowRoot) {\n      return;\n    }\n\n    this.shadowRoot.innerHTML = `\n      <style>\n        :host {\n          display: block;\n          padding: 8px 0;\n        }\n\n        .form {\n          display: grid;\n          gap: 16px;\n        }\n      </style>\n      <div class=\"form\">\n        <ha-textfield\n          label=\"Title (optional)\"\n          data-field=\"title\"\n        ></ha-textfield>\n        <ha-textfield\n          label=\"Device suffix\"\n          helper=\"Matches entities ending in \\${device}_max_services, \\${device}_1_destination, etc.\"\n          persistent-helper\n          data-field=\"device\"\n        ></ha-textfield>\n      </div>\n    `;\n\n    this.shadowRoot.querySelectorAll(\"ha-textfield\").forEach((field) => {\n      const input = field as { value?: string; dataset?: DOMStringMap };\n      const key = input.dataset?.field as keyof RailCardConfig | undefined;\n\n      if (key === \"title\") {\n        input.value = this._config?.title ?? \"\";\n      }\n\n      if (key === \"device\") {\n        input.value = this._config?.device ?? \"\";\n      }\n\n      field.addEventListener(\"input\", (event) => {\n        const target = event.target as {\n          value?: string;\n          dataset?: DOMStringMap;\n        };\n        const key = target.dataset?.field as keyof RailCardConfig | undefined;\n        const value = target.value ?? \"\";\n\n        if (!key) {\n          return;\n        }\n\n        this.updateConfigValue(key, value);\n      });\n    });\n  }\n}\n\ncustomElements.define(\"uk-rail-card\", UkRailCard);\ncustomElements.define(\"uk-rail-card-editor\", UkRailCardEditor);\n\n(window as { customCards?: Array<Record<string, unknown>> }).customCards =\n  (window as { customCards?: Array<Record<string, unknown>> }).customCards ||\n  [];\n\n(window as { customCards?: Array<Record<string, unknown>> }).customCards?.push({\n  type: \"uk-rail-card\",\n  name: \"UK Rail Card\",\n  description:\n    \"Displays upcoming rail services with scheduled and estimated times.\",\n});\n"],"names":[],"mappings":"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"}