{"version":3,"file":"uk-rail-card.js","sources":["../src/uk-rail-card.ts"],"sourcesContent":["interface RailCardConfig {\n  type: string;\n  title?: string;\n  device: string;\n}\n\ntype HomeAssistant = {\n  states: Record<\n    string,\n    { state: string; attributes: Record<string, unknown> }\n  >;\n};\n\nclass UkRailCard extends HTMLElement {\n  private _config?: RailCardConfig;\n  private _hass?: HomeAssistant;\n\n  constructor() {\n    super();\n    this.attachShadow({ mode: \"open\" });\n  }\n\n  static getStubConfig(): RailCardConfig {\n    return {\n      type: \"custom:uk-rail-card\",\n      title: \"Rail Services\",\n      device: \"rail_station\",\n    };\n  }\n\n  setConfig(config: RailCardConfig): void {\n    if (!config.device) {\n      throw new Error(\"You must define a device\");\n    }\n\n    this._config = config;\n    this.render();\n  }\n\n  set hass(hass: HomeAssistant) {\n    this._hass = hass;\n    this.render();\n  }\n\n  getCardSize(): number {\n    return 3;\n  }\n\n  private findEntityId(suffix: string): string | undefined {\n    if (!this._hass) {\n      return undefined;\n    }\n\n    return Object.keys(this._hass.states).find((entityId) =>\n      entityId.endsWith(suffix)\n    );\n  }\n\n  private getEntityState(entityId?: string): string {\n    if (!entityId || !this._hass) {\n      return \"\";\n    }\n\n    return this._hass.states[entityId]?.state ?? \"\";\n  }\n\n  private render(): void {\n    if (!this.shadowRoot || !this._config || !this._hass) {\n      return;\n    }\n\n    console.log(\"...::: UK RAIL CARD :::...\");\n\n    const deviceSuffix = this._config.device;\n    const maxEntityId =\n      this.findEntityId(`${deviceSuffix}_max_services`) ||\n      this.findEntityId(\"max_services\");\n    const maxServices = Number(this.getEntityState(maxEntityId)) || 0;\n\n    const rows: Array<{\n      scheduled: string;\n      destination: string;\n      estimated: string;\n    }> = [];\n\n    for (let index = 1; index <= maxServices; index += 1) {\n      const destinationId =\n        this.findEntityId(`${deviceSuffix}_${index}_destination`) ||\n        this.findEntityId(`${index}_destination`);\n      const destination = this.getEntityState(destinationId).trim();\n\n      if (!destination) {\n        break;\n      }\n\n      const scheduledId =\n        this.findEntityId(`${deviceSuffix}_${index}_scheduled_time`) ||\n        this.findEntityId(`${index}_scheduled_time`);\n      const estimatedId =\n        this.findEntityId(`${deviceSuffix}_${index}_estimated_time`) ||\n        this.findEntityId(`${index}_estimated_time`);\n\n      rows.push({\n        scheduled: this.getEntityState(scheduledId) || \"-\",\n        destination,\n        estimated: this.getEntityState(estimatedId) || \"-\",\n      });\n    }\n\n    const title = this._config.title?.trim();\n\n    this.shadowRoot.innerHTML = `\n      <style>\n        :host {\n          display: block;\n        }\n\n        ha-card {\n          overflow: hidden;\n        }\n\n        .header {\n          padding: 16px 16px 0 16px;\n        }\n\n        .title {\n          font-size: 1.1rem;\n          font-weight: 600;\n          line-height: 1.4;\n        }\n\n        .table {\n          display: grid;\n          grid-template-columns: minmax(70px, 0.8fr) 2fr minmax(70px, 0.8fr);\n          gap: 4px 12px;\n          padding: 16px;\n        }\n\n        .head {\n          font-size: 0.75rem;\n          letter-spacing: 0.06em;\n          text-transform: uppercase;\n          color: var(--secondary-text-color);\n        }\n\n        .row {\n          display: contents;\n          font-size: 0.95rem;\n        }\n\n        .cell {\n          padding: 4px 0;\n          border-bottom: 1px solid rgba(0, 0, 0, 0.08);\n        }\n\n        .row:last-of-type .cell {\n          border-bottom: none;\n        }\n\n        .empty {\n          padding: 16px;\n          color: var(--secondary-text-color);\n          font-style: italic;\n        }\n      </style>\n      <ha-card>\n        ${\n          title\n            ? `<div class=\"header\"><div class=\"title\">${title}</div></div>`\n            : \"\"\n        }\n        ${\n          rows.length\n            ? `\n              <div class=\"table\">\n                <div class=\"head\">Scheduled</div>\n                <div class=\"head\">Destination</div>\n                <div class=\"head\">Estimated</div>\n                ${rows\n                  .map(\n                    (row) => `\n                      <div class=\"row\">\n                        <div class=\"cell\">${row.scheduled}</div>\n                        <div class=\"cell\">${row.destination}</div>\n                        <div class=\"cell\">${row.estimated}</div>\n                      </div>\n                    `\n                  )\n                  .join(\"\")}\n              </div>\n            `\n            : `<div class=\"empty\">No services available.</div>`\n        }\n      </ha-card>\n    `;\n  }\n}\n\ncustomElements.define(\"uk-rail-card\", UkRailCard);\n\n(window as { customCards?: Array<Record<string, unknown>> }).customCards =\n  (window as { customCards?: Array<Record<string, unknown>> }).customCards ||\n  [];\n\n(window as { customCards?: Array<Record<string, unknown>> }).customCards?.push({\n  type: \"uk-rail-card\",\n  name: \"UK Rail Card\",\n  description:\n    \"Displays upcoming rail services with scheduled and estimated times.\",\n});\n"],"names":[],"mappings":"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"}